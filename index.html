<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سنگ، کاغذ، قیچی - فصل اول: فرار از سایه‌ها</title>
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
        }

        .container {
            background-color: white;
            padding: 20px 40px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 90%;
        }

        h1 {
            color: #333;
        }

        .section-title {
            font-size: 1.2rem;
            margin-top: 20px;
        }

        .setting-options button,
        .play-again-btn,
        #start-story-btn,
        #profile-creation-btn,
        .story-button {
            padding: 8px 15px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            background-color: #f8f8f8;
        }
        
        .play-again-btn, #story-mode-btn {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        .game-area {
            display: none;
            flex-direction: column;
            align-items: center;
        }
        
        .game-countdown {
            font-size: 3rem;
            font-weight: bold;
            color: #d9534f;
        }

        .hands-display {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin: 20px 0;
        }

        .hand {
            font-size: 100px;
            transform: scaleX(-1);
        }

        .hand.computer-hand {
            transform: scaleX(1);
        }

        #game-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        #game-options button {
            font-size: 50px;
            padding: 10px 20px;
            background: none;
            border: 2px solid #ccc;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        #game-options button:hover {
            transform: scale(1.1);
        }

        .score-display {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 10px;
        }

        #final-result {
            font-size: 2rem;
            font-weight: bold;
            color: #28a745;
        }
        
        .story-mode-display {
            display: none;
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f8f8;
            border-radius: 8px;
        }

        .story-mode-dialogue {
            font-style: italic;
            color: #555;
            margin-top: 10px;
        }

        #intro-story-section {
            display: none;
            font-size: 1.2rem;
            line-height: 1.8;
            padding: 20px;
            text-align: justify;
        }

        #profile-creation-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        #final-story-section {
            display: none;
            font-size: 1.5rem;
            font-weight: bold;
            line-height: 1.8;
            padding: 20px;
            color: #d9534f;
        }

        #player-name-input {
            padding: 10px;
            font-size: 1.2rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-align: center;
        }

        #gender-options {
            display: flex;
            gap: 10px;
        }
        
        .gender-btn.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
    </style>
</head>
<body>

    <div id="main-content">
        <div class="container">
            <h1>سنگ، کاغذ، قیچی</h1>

            <div id="start-section">
                <p class="section-title">به بازی خوش آمدید!</p>
                <button class="play-again-btn" id="start-story-btn">شروع داستان</button>
            </div>

            <div id="profile-creation-section" style="display: none;">
                <p class="section-title">پروفایل خود را بسازید</p>
                <input type="text" id="player-name-input" placeholder="نام شما" maxlength="15">
                <div id="gender-options">
                    <button class="gender-btn" data-gender="مرد">👦 مرد</button>
                    <button class="gender-btn" data-gender="زن">👧 زن</button>
                </div>
                <button id="profile-creation-btn" style="display: none;">تایید</button>
            </div>
            
            <div id="intro-story-section">
                <p>در یک شب بارانی، شما را بی‌رحمانه گرفتند و به اینجا آوردند. این یک زندان معمولی نیست؛ اینجا میدان نبرد است، جایی برای بازی‌های مرگ و زندگی. شما راهی برای فرار از دست آنها ندارید، مگر اینکه در بازی سنگ، کاغذ، قیچی پیروز شوید.</p>
                <p>تنها انگیزه شما، نجات برادر کوچک خودتان است که او نیز در اسارت است. هر پیروزی، شما را یک قدم به آزادی او نزدیک‌تر می‌کند. شکست... به معنای پایان است.</p>
                <button class="story-button" id="start-first-stage-btn">شروع ماجراجویی</button>
            </div>

            <div id="story-mode-section" class="story-mode-display">
                <h2 id="story-stage-title"></h2>
                <p id="story-opponent-name"></p>
                <p id="story-dialogue" class="story-mode-dialogue"></p>
            </div>

            <div class="game-area" id="game-area-container">
                <div id="countdown" class="game-countdown"></div>
                <div class="hands-display">
                    <div id="player-hand" class="hand"></div>
                    <div id="computer-hand" class="hand computer-hand"></div>
                </div>
                <div id="game-options">
                    <button id="rock-btn">✊</button>
                    <button id="paper-btn">🖐️</button>
                    <button id="scissors-btn">✌️</button>
                </div>
                
                <p class="score-display">شما: <span id="player-score">0</span> - حریف: <span id="computer-score">0</span></p>
            </div>

            <div id="end-game-section" style="display: none;">
                <p id="final-result"></p>
                <button class="play-again-btn">بازی دوباره</button>
            </div>

            <div id="final-story-section" style="display: none;">
                <p>با آخرین پیروزی، شما نفس‌نفس می‌زنید. نگهبانان ترسیده به شما نگاه می‌کنند. برادر کوچکتان را در آغوش می‌گیرید. صدای شلیک گلوله می‌آید، از پشت سر ... دنیا سیاه می‌شود.
                <br><br>
                منتظر فصل دوم باشید . . .</p>
            </div>
            
        </div>
    </div>

    <script>
        const gameChoices = document.querySelectorAll('#game-options button');
        const startStoryBtn = document.getElementById('start-story-btn');
        const introStorySection = document.getElementById('intro-story-section');
        const startFirstStageBtn = document.getElementById('start-first-stage-btn');
        const profileCreationSection = document.getElementById('profile-creation-section');
        const playerNameInput = document.getElementById('player-name-input');
        const genderOptions = document.querySelectorAll('.gender-btn');
        const profileCreationBtn = document.getElementById('profile-creation-btn');
        const storyModeSection = document.getElementById('story-mode-section');
        const storyStageTitle = document.getElementById('story-stage-title');
        const storyOpponentName = document.getElementById('story-opponent-name');
        const storyDialogue = document.getElementById('story-dialogue');
        const gameAreaContainer = document.getElementById('game-area-container');
        const endGameStateSection = document.getElementById('end-game-section');
        const finalResultDisplay = document.getElementById('final-result');
        const finalStorySection = document.getElementById('final-story-section');
        const playAgainBtns = document.querySelectorAll('.play-again-btn');

        const choices = ['rock', 'paper', 'scissors'];
        const rules = {
            rock: 'scissors',
            paper: 'rock',
            scissors: 'paper'
        };

        const choiceIcons = {
            rock: '✊',
            paper: '🖐️',
            scissors: '✌️'
        };
        
        // اطلاعات بازیکن
        let playerName = '';
        let playerGender = ''; // 'مرد' or 'زن'
        let playerScore = 0;
        let computerScore = 0;
        let playerHistory = [];
        let isGameActive = false;
        let currentStageIndex = 0;
        let countdownInterval;

        // --- داده‌های حالت داستانی ---
        const storyStages = [
            { name: "گارد یک", difficulty: "easy", dialogueStart: "فکر کردی می‌تونی از اینجا فرار کنی؟ برو به برادرت ملحق شو.", dialogueWin: "عجب! تو قوی‌تر از چیزی بودی که فکر می‌کردم، {name}.", dialogueLose: "نخیر... تو اینجا می‌مونی، {name}." },
            { name: "گارد دو", difficulty: "easy", dialogueStart: "بیا این بازی رو شروع کنیم تا زودتر تموم بشه. می‌خوام به خونه برم.", dialogueWin: "تو خیلی قوی هستی، {name}. امیدوارم به برادرت برسی.", dialogueLose: "تو اینجا گیر افتادی. مثل همه ما." },
            { name: "نگهبان بی‌رحم", difficulty: "medium", dialogueStart: "شنیدم برای نجات برادرت اومدی، {name}. داستانت خیلی قشنگه، ولی هیچوقت به پایان خوش نمی‌رسه.", dialogueWin: "غیرممکنه! از این آدمای احمق همیشه بهتر بودم. تو کی هستی؟", dialogueLose: "بهت که گفتم داستانت پایان خوش نداره." },
            { name: "رئیس بی‌رحم", difficulty: "hard", dialogueStart: "تو اینجا چه کار می‌کنی؟ تو که نمی‌تونی از این کارها بکنی. تو فقط یک آدم معمولی هستی.", dialogueWin: "عالی بود، آماده‌ام برای مرحله بعد.", dialogueLose: "فقط یک شانس بود!" },
            { name: "پروفسور مریم", difficulty: "hard", dialogueStart: "من الگوریتم‌های بازی رو خودم نوشتم. شانسی نداری.", dialogueWin: "غیرممکنه! چطور الگوریتم من رو شکستی؟", dialogueLose: "همیشه می‌دونم داری چه کاری می‌کنی." },
            { name: "بازیکن نهایی", difficulty: "hard", dialogueStart: "اینجا پایان راه است. آیا آماده‌ای؟", dialogueWin: "تو برنده هستی... کل بازی رو بردی! بهت افتخار می‌کنم!", dialogueLose: "این پایان راه برای توست." },
            // ... (برای کامل کردن 35 مرحله، می‌توانید موارد بیشتری را با این ساختار اضافه کنید)
        ];

        // --- مدیریت پروفایل و ذخیره‌سازی داده‌ها ---
        function saveProfile() {
            localStorage.setItem('playerName', playerName);
            localStorage.setItem('playerGender', playerGender);
        }

        function loadProfile() {
            playerName = localStorage.getItem('playerName');
            playerGender = localStorage.getItem('playerGender');
            if (playerName && playerGender) {
                document.getElementById('start-section').style.display = 'block';
                document.getElementById('profile-creation-section').style.display = 'none';
            } else {
                document.getElementById('start-section').style.display = 'none';
                document.getElementById('profile-creation-section').style.display = 'flex';
            }
        }

        // --- Event Listeners ---
        startStoryBtn.addEventListener('click', () => {
            document.getElementById('start-section').style.display = 'none';
            introStorySection.style.display = 'block';
        });

        startFirstStageBtn.addEventListener('click', () => {
            introStorySection.style.display = 'none';
            storyModeSection.style.display = 'block';
            gameAreaContainer.style.display = 'flex';
            startStage(currentStageIndex);
        });

        genderOptions.forEach(btn => {
            btn.addEventListener('click', () => {
                genderOptions.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                playerGender = btn.dataset.gender;
                checkProfileReady();
            });
        });

        playerNameInput.addEventListener('input', () => {
            checkProfileReady();
        });

        profileCreationBtn.addEventListener('click', () => {
            playerName = playerNameInput.value.trim();
            if (playerName && playerGender) {
                saveProfile();
                profileCreationSection.style.display = 'none';
                document.getElementById('start-section').style.display = 'block';
                startStoryBtn.click(); // شروع خودکار بازی
            }
        });

        function checkProfileReady() {
            if (playerNameInput.value.trim() && playerGender) {
                profileCreationBtn.style.display = 'block';
            } else {
                profileCreationBtn.style.display = 'none';
            }
        }
        
        // --- منطق بازی ---
        gameChoices.forEach(button => {
            button.addEventListener('click', (e) => {
                if (!isGameActive) return;
                isGameActive = false;
                
                const playerChoice = e.target.id.replace('-btn', '');
                playerHistory.push(playerChoice);
                
                const computerChoice = getComputerChoice();
                
                showHands(playerChoice, computerChoice);
                
                setTimeout(() => {
                    const result = determineWinner(playerChoice, computerChoice);
                    updateScores(result);
                    progressStory(result);
                }, 3000);
            });
        });

        function startStage(stageIndex) {
            if (stageIndex >= storyStages.length) {
                endStoryMode(true);
                return;
            }
            
            const stage = storyStages[stageIndex];
            difficulty = stage.difficulty;
            
            storyStageTitle.textContent = `مرحله ${stageIndex + 1}`;
            storyOpponentName.textContent = `حریف: ${stage.name}`;
            storyDialogue.textContent = stage.dialogueStart.replace('{name}', playerName);
            
            resetGame();
            isGameActive = true;
        }

        function progressStory(result) {
            const stage = storyStages[currentStageIndex];
            const dialogue = result === 'win' ? stage.dialogueWin : stage.dialogueLose;
            storyDialogue.textContent = dialogue.replace('{name}', playerName);
            
            setTimeout(() => {
                if (result === 'win') {
                    if (currentStageIndex === storyStages.length - 1) {
                        endStoryMode(true);
                    } else {
                        currentStageIndex++;
                        startStage(currentStageIndex);
                    }
                } else {
                    endStoryMode(false);
                }
            }, 2000);
        }

        function endStoryMode(isWinner) {
            isGameActive = false;
            storyModeSection.style.display = 'none';
            gameAreaContainer.style.display = 'none';

            if (isWinner) {
                finalStorySection.style.display = 'block';
            } else {
                let finalMessage = `شما شکست خوردید.`;
                finalResultDisplay.textContent = finalMessage;
                endGameStateSection.style.display = 'flex';
            }
        }
        
        // --- توابع کمکی ---
        function showHands(playerChoice, computerChoice) {
            let count = 3;
            document.getElementById('countdown').textContent = count;
            document.getElementById('player-hand').textContent = choiceIcons[playerChoice];
            document.getElementById('computer-hand').textContent = '✊';
            
            countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    document.getElementById('countdown').textContent = count;
                } else if (count === 0) {
                    document.getElementById('countdown').textContent = 'برو!';
                }
                
                if (count < 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('countdown').textContent = '';
                    document.getElementById('player-hand').textContent = choiceIcons[playerChoice];
                    document.getElementById('computer-hand').textContent = choiceIcons[computerChoice];
                }
            }, 1000);
        }

        function getComputerChoice() {
            const lastTwoMoves = playerHistory.slice(-2);
            if (lastTwoMoves.length >= 2 && lastTwoMoves[0] === lastTwoMoves[1]) {
                return rules[lastTwoMoves[0]];
            }
            return choices[Math.floor(Math.random() * choices.length)];
        }

        function determineWinner(playerChoice, computerChoice) {
            if (playerChoice === computerChoice) return 'draw';
            if (rules[playerChoice] === computerChoice) return 'win';
            return 'lose';
        }

        function updateScores(result) {
            if (result === 'win') {
                playerScore++;
            } else if (result === 'lose') {
                computerScore++;
            }
            document.getElementById('player-score').textContent = playerScore;
            document.getElementById('computer-score').textContent = computerScore;
        }

        function resetGame() {
            playerScore = 0;
            computerScore = 0;
            document.getElementById('player-score').textContent = 0;
            document.getElementById('computer-score').textContent = 0;
            document.getElementById('countdown').textContent = '';
            document.getElementById('player-hand').textContent = '';
            document.getElementById('computer-hand').textContent = '';
            endGameStateSection.style.display = 'none';
        }

        playAgainBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                window.location.reload(); // ساده‌ترین راه برای شروع مجدد
            });
        });

        // بارگذاری پروفایل در هنگام بارگذاری صفحه
        window.onload = loadProfile;
    </script>
</body>
</html>
