<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุณูฺฏุ ฺฉุงุบุฐุ ูฺ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        h1 {
            color: #333;
        }
        .hidden {
            display: none;
        }
        .section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .story-mode-dialogue {
            margin-top: 15px;
            font-style: italic;
            color: #555;
            min-height: 50px;
        }
        .hand {
            font-size: 80px;
        }
        #game-options button {
            font-size: 40px;
            margin: 10px;
        }
        .play-again-btn, #start-story-btn, #profile-creation-btn, .gender-btn {
            padding: 10px 20px;
            margin-top: 10px;
            cursor: pointer;
        }
        .active {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ุณูฺฏุ ฺฉุงุบุฐุ ูฺ</h1>

        <div id="start-section" class="section">
            <p>ุจู ุจุงุฒ ุฎูุด ุขูุฏุฏ!</p>
            <button id="start-story-btn">ุดุฑูุน ุฏุงุณุชุงู</button>
        </div>

        <div id="profile-creation-section" class="section hidden">
            <h3>ูพุฑููุงู ุฎูุฏ ุฑุง ุจุณุงุฒุฏ</h3>
            <input type="text" id="player-name-input" placeholder="ูุงู ุดูุง" maxlength="15">
            <div>
                <button class="gender-btn" data-gender="ูุฑุฏ">๐ฆ ูุฑุฏ</button>
                <button class="gender-btn" data-gender="ุฒู">๐ง ุฒู</button>
            </div>
            <button id="profile-creation-btn" class="hidden">ุชุงุฏ</button>
        </div>
        
        <div id="intro-story-section" class="section hidden">
            <p>ุฏุฑ ฺฉ ุดุจ ุจุงุฑุงูุ ุดูุง ุฑุง ุจโุฑุญูุงูู ฺฏุฑูุชูุฏ ู ุจู ุงูุฌุง ุขูุฑุฏูุฏ. ุงู ฺฉ ุฒูุฏุงู ูุนููู ูุณุชุ ุงูุฌุง ูุฏุงู ูุจุฑุฏ ุงุณุชุ ุฌุง ุจุฑุง ุจุงุฒโูุง ูุฑฺฏ ู ุฒูุฏฺฏ. ุดูุง ุฑุงู ุจุฑุง ูุฑุงุฑ ุงุฒ ุฏุณุช ุขููุง ูุฏุงุฑุฏุ ูฺฏุฑ ุงูฺฉู ุฏุฑ ุจุงุฒ ุณูฺฏุ ฺฉุงุบุฐุ ูฺ ูพุฑูุฒ ุดูุฏ.</p>
            <p>ุชููุง ุงูฺฏุฒู ุดูุงุ ูุฌุงุช ุจุฑุงุฏุฑ ฺฉูฺฺฉ ุฎูุฏุชุงู ุงุณุช ฺฉู ุงู ูุฒ ุฏุฑ ุงุณุงุฑุช ุงุณุช. ูุฑ ูพุฑูุฒุ ุดูุง ุฑุง ฺฉ ูุฏู ุจู ุขุฒุงุฏ ุงู ูุฒุฏฺฉโุชุฑ ูโฺฉูุฏ. ุดฺฉุณุช... ุจู ูุนูุง ูพุงุงู ุงุณุช.</p>
            <button class="story-button" id="start-first-stage-btn">ุดุฑูุน ูุงุฌุฑุงุฌู</button>
        </div>

        <div id="story-mode-section" class="section hidden">
            <h2 id="story-stage-title"></h2>
            <p id="story-opponent-name"></p>
            <p id="story-dialogue" class="story-mode-dialogue"></p>
        </div>

        <div id="game-area-container" class="section hidden">
            <div id="countdown" class="game-countdown"></div>
            <div class="hands-display">
                <div id="player-hand" class="hand"></div>
                <div id="computer-hand" class="hand"></div>
            </div>
            <div id="game-options">
                <button id="rock-btn">โ</button>
                <button id="paper-btn">๐๏ธ</button>
                <button id="scissors-btn">โ๏ธ</button>
            </div>
            <p class="score-display">ุดูุง: <span id="player-score">0</span> - ุญุฑู: <span id="computer-score">0</span></p>
        </div>

        <div id="end-game-section" class="section hidden">
            <p id="final-result"></p>
            <button class="play-again-btn">ุจุงุฒ ุฏูุจุงุฑู</button>
        </div>

        <div id="final-story-section" class="section hidden">
            <p>ุจุง ุขุฎุฑู ูพุฑูุฒุ ุดูุง ููุณโููุณ ูโุฒูุฏ. ูฺฏูุจุงูุงู ุชุฑุณุฏู ุจู ุดูุง ูฺฏุงู ูโฺฉููุฏ. ุจุฑุงุฏุฑ ฺฉูฺฺฉุชุงู ุฑุง ุฏุฑ ุขุบูุด ูโฺฏุฑุฏ. ุตุฏุง ุดูฺฉ ฺฏูููู ูโุขุฏุ ุงุฒ ูพุดุช ุณุฑ ... ุฏูุง ุณุงู ูโุดูุฏ.
            <br><br>
            ููุชุธุฑ ูุตู ุฏูู ุจุงุดุฏ . . .</p>
        </div>
    </div>

    <script>
        const gameChoices = document.querySelectorAll('#game-options button');
        const startStoryBtn = document.getElementById('start-story-btn');
        const introStorySection = document.getElementById('intro-story-section');
        const startFirstStageBtn = document.getElementById('start-first-stage-btn');
        const profileCreationSection = document.getElementById('profile-creation-section');
        const playerNameInput = document.getElementById('player-name-input');
        const genderOptions = document.querySelectorAll('.gender-btn');
        const profileCreationBtn = document.getElementById('profile-creation-btn');
        const storyModeSection = document.getElementById('story-mode-section');
        const storyStageTitle = document.getElementById('story-stage-title');
        const storyOpponentName = document.getElementById('story-opponent-name');
        const storyDialogue = document.getElementById('story-dialogue');
        const gameAreaContainer = document.getElementById('game-area-container');
        const endGameStateSection = document.getElementById('end-game-section');
        const finalResultDisplay = document.getElementById('final-result');
        const finalStorySection = document.getElementById('final-story-section');
        const playAgainBtns = document.querySelectorAll('.play-again-btn');

        const choices = ['rock', 'paper', 'scissors'];
        const rules = {
            rock: 'scissors',
            paper: 'rock',
            scissors: 'paper'
        };

        const choiceIcons = {
            rock: 'โ',
            paper: '๐๏ธ',
            scissors: 'โ๏ธ'
        };
        
        let playerName = '';
        let playerGender = '';
        let playerScore = 0;
        let computerScore = 0;
        let playerHistory = [];
        let isGameActive = false;
        let currentStageIndex = 0;
        let countdownInterval;

        const storyStages = [
            { name: "ฺฏุงุฑุฏ ฺฉ", difficulty: "easy", dialogueStart: "ูฺฉุฑ ฺฉุฑุฏ ูโุชูู ุงุฒ ุงูุฌุง ูุฑุงุฑ ฺฉูุ ุจุฑู ุจู ุจุฑุงุฏุฑุช ููุญู ุดู.", dialogueWin: "ุนุฌุจ! ุชู ููโุชุฑ ุงุฒ ฺุฒ ุจูุฏ ฺฉู ูฺฉุฑ ูโฺฉุฑุฏูุ {name}.", dialogueLose: "ูุฎุฑ... ุชู ุงูุฌุง ูโูููุ {name}." },
            { name: "ฺฏุงุฑุฏ ุฏู", difficulty: "easy", dialogueStart: "ุจุง ุงู ุจุงุฒ ุฑู ุดุฑูุน ฺฉูู ุชุง ุฒูุฏุชุฑ ุชููู ุจุดู. ูโุฎูุงู ุจู ุฎููู ุจุฑู.", dialogueWin: "ุชู ุฎู ูู ูุณุชุ {name}. ุงูุฏูุงุฑู ุจู ุจุฑุงุฏุฑุช ุจุฑุณ.", dialogueLose: "ุชู ุงูุฌุง ฺฏุฑ ุงูุชุงุฏ. ูุซู ููู ูุง." },
            { name: "ูฺฏูุจุงู ุจโุฑุญู", difficulty: "medium", dialogueStart: "ุดูุฏู ุจุฑุง ูุฌุงุช ุจุฑุงุฏุฑุช ุงููุฏุ {name}. ุฏุงุณุชุงูุช ุฎู ูุดูฺฏูุ ูู ูฺููุช ุจู ูพุงุงู ุฎูุด ููโุฑุณู.", dialogueWin: "ุบุฑููฺฉูู! ุงุฒ ุงู ุขุฏูุง ุงุญูู ููุดู ุจูุชุฑ ุจูุฏู. ุชู ฺฉ ูุณุชุ", dialogueLose: "ุจูุช ฺฉู ฺฏูุชู ุฏุงุณุชุงูุช ูพุงุงู ุฎูุด ูุฏุงุฑู." },
            { name: "ุฑุฆุณ ุจโุฑุญู", difficulty: "hard", dialogueStart: "ุชู ุงูุฌุง ฺู ฺฉุงุฑ ูโฺฉูุ ุชู ฺฉู ููโุชูู ุงุฒ ุงู ฺฉุงุฑูุง ุจฺฉู. ุชู ููุท ฺฉ ุขุฏู ูุนููู ูุณุช.", dialogueWin: "ุนุงู ุจูุฏุ ุขูุงุฏูโุงู ุจุฑุง ูุฑุญูู ุจุนุฏ.", dialogueLose: "ููุท ฺฉ ุดุงูุณ ุจูุฏ!" },
            { name: "ูพุฑููุณูุฑ ูุฑู", difficulty: "hard", dialogueStart: "ูู ุงูฺฏูุฑุชูโูุง ุจุงุฒ ุฑู ุฎูุฏู ููุดุชู. ุดุงูุณ ูุฏุงุฑ.", dialogueWin: "ุบุฑููฺฉูู! ฺุทูุฑ ุงูฺฏูุฑุชู ูู ุฑู ุดฺฉุณุชุ", dialogueLose: "ููุดู ูโุฏููู ุฏุงุฑ ฺู ฺฉุงุฑ ูโฺฉู." },
            { name: "ุจุงุฒฺฉู ููุง", difficulty: "hard", dialogueStart: "ุงูุฌุง ูพุงุงู ุฑุงู ุงุณุช. ุขุง ุขูุงุฏูโุงุ", dialogueWin: "ุชู ุจุฑูุฏู ูุณุช... ฺฉู ุจุงุฒ ุฑู ุจุฑุฏ! ุจูุช ุงูุชุฎุงุฑ ูโฺฉูู!", dialogueLose: "ุงู ูพุงุงู ุฑุงู ุจุฑุง ุชูุณุช." },
        ];

        function showSection(id) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
        }

        function saveProfile() {
            localStorage.setItem('playerName', playerName);
            localStorage.setItem('playerGender', playerGender);
        }

        function loadProfile() {
            playerName = localStorage.getItem('playerName');
            playerGender = localStorage.getItem('playerGender');
            if (playerName && playerGender) {
                showSection('start-section');
            } else {
                showSection('profile-creation-section');
            }
        }

        startStoryBtn.addEventListener('click', () => {
            showSection('intro-story-section');
        });

        startFirstStageBtn.addEventListener('click', () => {
            showSection('story-mode-section');
            showSection('game-area-container');
            startStage(currentStageIndex);
        });

        genderOptions.forEach(btn => {
            btn.addEventListener('click', () => {
                genderOptions.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                playerGender = btn.dataset.gender;
                checkProfileReady();
            });
        });

        playerNameInput.addEventListener('input', () => {
            checkProfileReady();
        });

        profileCreationBtn.addEventListener('click', () => {
            playerName = playerNameInput.value.trim();
            if (playerName && playerGender) {
                saveProfile();
                showSection('start-section');
                startStoryBtn.click();
            }
        });

        function checkProfileReady() {
            if (playerNameInput.value.trim() && playerGender) {
                profileCreationBtn.classList.remove('hidden');
            } else {
                profileCreationBtn.classList.add('hidden');
            }
        }
        
        gameChoices.forEach(button => {
            button.addEventListener('click', (e) => {
                if (!isGameActive) return;
                isGameActive = false;
                
                const playerChoice = e.target.id.replace('-btn', '');
                playerHistory.push(playerChoice);
                
                const computerChoice = getComputerChoice();
                
                showHands(playerChoice, computerChoice);
                
                setTimeout(() => {
                    const result = determineWinner(playerChoice, computerChoice);
                    updateScores(result);
                    progressStory(result);
                }, 3000);
            });
        });

        function startStage(stageIndex) {
            if (stageIndex >= storyStages.length) {
                endStoryMode(true);
                return;
            }
            
            const stage = storyStages[stageIndex];
            
            storyStageTitle.textContent = `ูุฑุญูู ${stageIndex + 1}`;
            storyOpponentName.textContent = `ุญุฑู: ${stage.name}`;
            storyDialogue.textContent = stage.dialogueStart.replace('{name}', playerName);
            
            resetGame();
            isGameActive = true;
        }

        function progressStory(result) {
            const stage = storyStages[currentStageIndex];
            const dialogue = result === 'win' ? stage.dialogueWin : stage.dialogueLose;
            storyDialogue.textContent = dialogue.replace('{name}', playerName);
            
            setTimeout(() => {
                if (result === 'win') {
                    if (currentStageIndex === storyStages.length - 1) {
                        endStoryMode(true);
                    } else {
                        currentStageIndex++;
                        startStage(currentStageIndex);
                    }
                } else {
                    endStoryMode(false);
                }
            }, 2000);
        }

        function endStoryMode(isWinner) {
            isGameActive = false;
            showSection('end-game-section');
            if (isWinner) {
                showSection('final-story-section');
            } else {
                finalResultDisplay.textContent = `ุดูุง ุดฺฉุณุช ุฎูุฑุฏุฏ.`;
                showSection('end-game-section');
            }
        }
        
        function showHands(playerChoice, computerChoice) {
            let count = 3;
            document.getElementById('countdown').textContent = count;
            document.getElementById('player-hand').textContent = choiceIcons[playerChoice];
            document.getElementById('computer-hand').textContent = 'โ';
            
            countdownInterval = setInterval(() => {
                count--;
                if (count >= 0) {
                    document.getElementById('countdown').textContent = count > 0 ? count : 'ุจุฑู!';
                } else {
                    clearInterval(countdownInterval);
                    document.getElementById('countdown').textContent = '';
                    document.getElementById('player-hand').textContent = choiceIcons[playerChoice];
                    document.getElementById('computer-hand').textContent = choiceIcons[computerChoice];
                }
            }, 1000);
        }

        function getComputerChoice() {
            const lastTwoMoves = playerHistory.slice(-2);
            if (lastTwoMoves.length >= 2 && lastTwoMoves[0] === lastTwoMoves[1]) {
                return rules[lastTwoMoves[0]];
            }
            return choices[Math.floor(Math.random() * choices.length)];
        }

        function determineWinner(playerChoice, computerChoice) {
            if (playerChoice === computerChoice) return 'draw';
            if (rules[playerChoice] === computerChoice) return 'win';
            return 'lose';
        }

        function updateScores(result) {
            if (result === 'win') {
                playerScore++;
            } else if (result === 'lose') {
                computerScore++;
            }
            document.getElementById('player-score').textContent = playerScore;
            document.getElementById('computer-score').textContent = computerScore;
        }

        function resetGame() {
            playerScore = 0;
            computerScore = 0;
            document.getElementById('player-score').textContent = 0;
            document.getElementById('computer-score').textContent = 0;
            document.getElementById('countdown').textContent = '';
            document.getElementById('player-hand').textContent = '';
            document.getElementById('computer-hand').textContent = '';
        }

        playAgainBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                window.location.reload();
            });
        });

        window.onload = loadProfile;
    </script>
</body>
</html>
